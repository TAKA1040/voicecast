# 認証設計・設定ガイド

## 1. 認証方針

本アプリケーションの認証は、**Googleログインのみ**に限定しています。パスワードを利用した認証は、セキュリティリスクと運用コストを考慮し、採用していません。

- **認証プロバイダ**: Firebase Authentication (Google Provider)
- **管理者判定**: ログインしたユーザーのメールアドレスが、特定のアドレス（例: `dash201206@gmail.com`）と一致するかどうかで判定します。

## 2. 認証フロー概要

1.  **ログイン試行**: ユーザーがログインページの「Googleでログイン」ボタンをクリックします。
2.  **Google認証ポップアップ**: `signInWithPopup` が実行され、Googleの認証画面が表示されます。
3.  **認証完了とリダイレクト**: 認証が成功すると、Firebase SDKがユーザー情報を取得し、アプリケーションは管理画面 (`/admin`) にリダイレクトします。
4.  **認証状態の永続化**: Firebase SDKがIndexedDBにユーザーの認証情報を安全に保存するため、ページをリロードしてもログイン状態が維持されます。

## 3. Firebase コンソールでの設定

- **場所**: `Authentication` -> `Sign-in method` タブ
- **必須設定**:
    - `Google`: プロバイダを有効にし、プロジェクトのサポートメールアドレスを選択します。
- **禁止設定**:
    - `メール/パスワード`: **必ず無効にしてください。**

## 4. 認証状態の管理

クライアントサイドでの認証状態のチェックは、`app/hooks/useAuth.ts` というカスタムフックで一元管理されています。このフックが `onAuthStateChanged` をラップし、アプリケーション全体で現在のユーザー情報を利用可能にします。

## 5. 管理者判定ロジック

管理者のみがアクセスできる機能（例: エピソードの投稿）の制御は、Firestoreのセキュリティルールによってサーバーサイドで強制されます。

```
// firestore.rules
allow write: if request.auth != null && request.auth.token.email == 'dash201206@gmail.com';
```

これにより、クライアントサイドのコードに関わらず、指定された管理者アカウント以外によるデータの書き込みは確実にブロックされます。
