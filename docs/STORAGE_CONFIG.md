# Supabase Storage 運用設定

## 1. バケット構成

本プロジェクトで使用するストレージバケットは以下の通りです。

- **バケット名**: `audios`
- **公開設定**: **Public**

### なぜPublic設定なのか？

`audios` バケットは、ユーザー向けの再生画面で音声ファイルをストリーミングするために使用されます。そのため、URLを知っていれば誰でもアクセスできる `Public` 設定が必須となります。

ただし、セキュリティはRLSポリシーによって担保されています。`Public` 設定であっても、**アップロード・更新・削除**といった書き込み操作は、RLSポリシー（`docs/RLS_POLICIES.md` を参照）によって認証済みの所有者のみに厳格に制限されています。

## 2. ファイルパス命名規則

アップロードされる音声ファイルは、以下の命名規則に従って保存されます。

- **パス形式**: `{user_id}/{timestamp}_{original_filename}`
- **例**: `xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/1678886400000_episode1.mp3`

### この形式を採用する理由

- **`user_id`**: どのユーザーがアップロードしたファイルかを明確にし、RLSポリシーの `owner` との比較を容易にします。
- **`timestamp`**: ファイル名の衝突を確実に防ぎます。
- **`original_filename`**: 管理画面などで、元のファイル名を判別しやすくします。

この命名規則は、`components/admin-form.tsx` 内のアップロード処理で実装されています。
